<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Worduel</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600;700&family=Playfair+Display:ital,wght@0,700;0,900;1,700&display=swap" rel="stylesheet" />
  <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>

  <style>
    /* â•â•â• VARIABLES & RESET â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    :root {
      --bg:         #111113;
      --surface:    #1a1a1d;
      --surface2:   #242428;
      --border:     #3a3a3e;
      --text:       #f0f0f2;
      --text-muted: #7a7a85;
      --correct:    #538d4e;
      --present:    #b59f3b;
      --absent:     #3a3a3e;
      --tile-bg:    #1a1a1d;
      --tile-border:#3a3a3e;
      --key-bg:     #2d2d32;
      --key-text:   #f0f0f2;
      --accent:     #e8e8ec;
      --danger:     #c0392b;
      --warn:       #e67e22;
      --radius:     6px;
      --font-mono:  'IBM Plex Mono', monospace;
      --font-serif: 'Playfair Display', Georgia, serif;
    }
    [data-theme="light"] {
      --bg:         #f5f5f0;
      --surface:    #ffffff;
      --surface2:   #ebebea;
      --border:     #d0d0cc;
      --text:       #111113;
      --text-muted: #888880;
      --tile-bg:    #ffffff;
      --tile-border:#d0d0cc;
      --key-bg:     #d8d8d4;
      --key-text:   #111113;
      --absent:     #c0c0bb;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { font-size: 16px; }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--font-mono);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      transition: background .2s, color .2s;
      overflow-x: hidden;
    }

    /* â•â•â• UTILITY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .hidden { display: none !important; }
    button {
      cursor: pointer;
      font-family: var(--font-mono);
      border: none;
      outline: none;
    }
    input {
      font-family: var(--font-mono);
      outline: none;
    }

    /* â•â•â• HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1.5rem;
      height: 56px;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      background: var(--bg);
      z-index: 100;
    }
    .logo {
      font-family: var(--font-serif);
      font-size: 1.55rem;
      font-weight: 900;
      letter-spacing: .06em;
      color: var(--text);
    }
    .logo span { color: var(--text-muted); font-style: italic; }
    .header-actions { display: flex; gap: .5rem; }
    .icon-btn {
      background: none;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      color: var(--text-muted);
      padding: .3rem .5rem;
      font-size: .8rem;
      transition: color .15s, border-color .15s;
    }
    .icon-btn:hover { color: var(--text); border-color: var(--text-muted); }

    /* â•â•â• SCREENS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .screen {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 2rem 1rem 3rem;
    }

    /* â”€â”€â”€ HOME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #home-screen .tagline {
      font-family: var(--font-serif);
      font-style: italic;
      color: var(--text-muted);
      font-size: .95rem;
      margin-bottom: 2.5rem;
      margin-top: .25rem;
    }
    .home-title {
      font-family: var(--font-serif);
      font-size: 3.2rem;
      font-weight: 900;
      letter-spacing: .05em;
      line-height: 1;
      margin-bottom: .3rem;
      margin-top: 1.5rem;
    }
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 1.75rem;
      width: 100%;
      max-width: 420px;
    }
    .card + .card { margin-top: 1rem; }
    .card h2 {
      font-size: .8rem;
      letter-spacing: .1em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 1rem;
    }
    .name-row {
      display: flex;
      gap: .6rem;
      align-items: center;
      margin-bottom: 1.25rem;
    }
    .name-row label {
      font-size: .75rem;
      color: var(--text-muted);
      white-space: nowrap;
    }
    .input-field {
      flex: 1;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      color: var(--text);
      padding: .5rem .75rem;
      font-size: .875rem;
      transition: border-color .15s;
    }
    .input-field:focus { border-color: var(--text-muted); }
    .input-field::placeholder { color: var(--text-muted); }

    /* Word length picker */
    .length-label {
      font-size: .75rem;
      color: var(--text-muted);
      margin-bottom: .5rem;
    }
    .length-picker {
      display: flex;
      flex-wrap: wrap;
      gap: .4rem;
      margin-bottom: 1.25rem;
    }
    .len-btn {
      width: 36px;
      height: 36px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--surface2);
      color: var(--text-muted);
      font-size: .8rem;
      font-family: var(--font-mono);
      font-weight: 600;
      transition: all .15s;
    }
    .len-btn:hover { border-color: var(--text-muted); color: var(--text); }
    .len-btn.active {
      background: var(--text);
      color: var(--bg);
      border-color: var(--text);
    }

    /* Max players picker */
    .maxp-row {
      display: flex;
      align-items: center;
      gap: .75rem;
      margin-bottom: 1.25rem;
    }
    .maxp-row label { font-size: .75rem; color: var(--text-muted); }
    .maxp-row input[type=range] { flex: 1; accent-color: var(--text); }
    .maxp-val {
      font-size: .875rem;
      font-weight: 600;
      min-width: 2ch;
      text-align: right;
    }

    /* Room code input */
    .code-row {
      display: flex;
      gap: .5rem;
      margin-bottom: 1rem;
    }
    .code-input {
      flex: 1;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      color: var(--text);
      padding: .5rem .75rem;
      font-size: .95rem;
      letter-spacing: .15em;
      text-transform: uppercase;
      font-weight: 700;
    }
    .code-input:focus { border-color: var(--text-muted); }
    .code-input::placeholder { text-transform: none; letter-spacing: 0; font-weight: 400; color: var(--text-muted); }

    /* Buttons */
    .btn {
      width: 100%;
      padding: .7rem 1rem;
      border-radius: var(--radius);
      font-size: .875rem;
      font-weight: 700;
      letter-spacing: .05em;
      transition: opacity .15s, transform .1s;
    }
    .btn:active { transform: scale(.98); }
    .btn-primary {
      background: var(--text);
      color: var(--bg);
    }
    .btn-primary:hover { opacity: .88; }
    .btn-ghost {
      background: none;
      border: 1px solid var(--border);
      color: var(--text-muted);
    }
    .btn-ghost:hover { border-color: var(--text-muted); color: var(--text); }
    .btn + .btn { margin-top: .6rem; }
    .btn-danger { background: var(--danger); color: #fff; }
    .btn-danger:hover { opacity: .85; }

    /* Divider */
    .divider {
      display: flex;
      align-items: center;
      gap: .75rem;
      margin: .75rem 0;
      color: var(--text-muted);
      font-size: .75rem;
    }
    .divider::before, .divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    /* Tabs */
    .tabs {
      display: flex;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      margin-bottom: 1.25rem;
    }
    .tab {
      flex: 1;
      padding: .55rem;
      background: none;
      border: none;
      font-size: .8rem;
      font-weight: 700;
      letter-spacing: .05em;
      color: var(--text-muted);
      transition: all .15s;
    }
    .tab.active {
      background: var(--text);
      color: var(--bg);
    }

    /* â”€â”€â”€ LOBBY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #lobby-screen .lobby-wrap {
      width: 100%;
      max-width: 480px;
    }
    .lobby-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    .room-code-badge {
      font-size: 1.6rem;
      font-weight: 700;
      letter-spacing: .15em;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: .3rem .9rem;
      cursor: pointer;
      transition: border-color .15s;
    }
    .room-code-badge:hover { border-color: var(--text-muted); }
    .room-code-badge small {
      display: block;
      font-size: .65rem;
      letter-spacing: .05em;
      color: var(--text-muted);
      font-weight: 400;
      margin-bottom: .15rem;
    }
    .lobby-meta {
      font-size: .8rem;
      color: var(--text-muted);
      line-height: 1.6;
    }
    .player-list {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 1rem;
    }
    .player-list-header {
      padding: .6rem 1rem;
      font-size: .7rem;
      letter-spacing: .1em;
      text-transform: uppercase;
      color: var(--text-muted);
      border-bottom: 1px solid var(--border);
    }
    .player-item {
      display: flex;
      align-items: center;
      gap: .75rem;
      padding: .7rem 1rem;
      font-size: .875rem;
      border-bottom: 1px solid var(--border);
      transition: background .15s;
    }
    .player-item:last-child { border-bottom: none; }
    .player-avatar {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--surface2);
      border: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: .75rem;
      font-weight: 700;
      flex-shrink: 0;
    }
    .player-name { flex: 1; }
    .player-tag {
      font-size: .65rem;
      letter-spacing: .08em;
      text-transform: uppercase;
      color: var(--text-muted);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: .1rem .4rem;
    }
    .player-tag.host { color: var(--text); border-color: var(--text-muted); }
    .player-tag.you { color: var(--correct); border-color: var(--correct); }
    .countdown-ring {
      text-align: center;
      margin: .5rem 0 1rem;
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--text-muted);
    }
    .countdown-ring small {
      display: block;
      font-size: .7rem;
      letter-spacing: .1em;
      text-transform: uppercase;
      margin-top: -.2rem;
    }

    /* â”€â”€â”€ GAME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #game-screen {
      flex-direction: row;
      justify-content: center;
      align-items: flex-start;
      gap: 1.5rem;
      padding-top: 1.5rem;
    }
    .game-sidebar {
      width: 200px;
      flex-shrink: 0;
    }
    .sidebar-title {
      font-size: .7rem;
      letter-spacing: .1em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: .6rem;
    }
    .mp-player-item {
      display: flex;
      align-items: center;
      gap: .5rem;
      padding: .5rem .6rem;
      border-radius: var(--radius);
      margin-bottom: .3rem;
      font-size: .8rem;
      border: 1px solid transparent;
      transition: background .2s;
    }
    .mp-player-item.is-you { border-color: var(--border); background: var(--surface); }
    .mp-pip {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--border);
      flex-shrink: 0;
      transition: background .3s;
    }
    .mp-pip.solved { background: var(--correct); }
    .mp-pip.failed { background: var(--danger); }
    .mp-pip.active { background: var(--present); }
    .mp-player-name { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .mp-player-score { color: var(--text-muted); font-size: .75rem; }

    /* BOARD */
    .game-center { display: flex; flex-direction: column; align-items: center; }
    #board {
      display: grid;
      gap: 5px;
      margin-bottom: 1.2rem;
    }
    .tile {
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: var(--font-mono);
      font-weight: 700;
      text-transform: uppercase;
      border: 2px solid var(--tile-border);
      border-radius: 4px;
      background: var(--tile-bg);
      color: var(--text);
      user-select: none;
      transition: border-color .1s;
      position: relative;
    }
    .tile.filled { border-color: var(--text-muted); animation: pop .1s ease; }
    .tile.revealed { border-color: transparent; animation: flipIn .4s ease forwards; }
    .tile[data-state="correct"]  { background: var(--correct); color: #fff; }
    .tile[data-state="present"]  { background: var(--present); color: #fff; }
    .tile[data-state="absent"]   { background: var(--absent);  color: var(--text); }

    @keyframes pop {
      0%   { transform: scale(1); }
      50%  { transform: scale(1.12); }
      100% { transform: scale(1); }
    }
    @keyframes flipIn {
      0%   { transform: rotateX(0deg); }
      45%  { transform: rotateX(-90deg); }
      55%  { transform: rotateX(-90deg); }
      100% { transform: rotateX(0deg); }
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      15%  { transform: translateX(-6px); }
      30%  { transform: translateX(6px); }
      45%  { transform: translateX(-5px); }
      60%  { transform: translateX(5px); }
      75%  { transform: translateX(-3px); }
      90%  { transform: translateX(3px); }
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      40%  { transform: translateY(-18px); }
      60%  { transform: translateY(-10px); }
    }
    .row-shake   { animation: shake .5s ease; }
    .tile-bounce { animation: bounce .5s ease; }

    /* KEYBOARD */
    #keyboard {
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: center;
      width: 100%;
      max-width: 500px;
    }
    .kb-row { display: flex; gap: 5px; }
    .key {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 34px;
      height: 56px;
      border-radius: 5px;
      border: none;
      background: var(--key-bg);
      color: var(--key-text);
      font-family: var(--font-mono);
      font-size: .8rem;
      font-weight: 700;
      text-transform: uppercase;
      cursor: pointer;
      transition: background .2s, color .2s, transform .08s;
      user-select: none;
      flex-shrink: 0;
    }
    .key:active { transform: scale(.92); }
    .key.wide { min-width: 58px; font-size: .7rem; }
    .key[data-state="correct"] { background: var(--correct); color: #fff; }
    .key[data-state="present"] { background: var(--present); color: #fff; }
    .key[data-state="absent"]  { background: var(--absent);  color: var(--text-muted); }

    /* TOAST */
    #toast-container {
      position: fixed;
      top: 70px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 999;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: .4rem;
      pointer-events: none;
    }
    .toast {
      background: var(--text);
      color: var(--bg);
      font-size: .8rem;
      font-weight: 700;
      padding: .5rem 1.1rem;
      border-radius: 20px;
      letter-spacing: .05em;
      animation: toastIn .25s ease, toastOut .3s ease 1.7s forwards;
    }
    @keyframes toastIn  { from { opacity: 0; transform: translateY(-8px); } to { opacity: 1; transform: none; } }
    @keyframes toastOut { to   { opacity: 0; transform: translateY(-8px); } }

    /* CONNECTING OVERLAY */
    #connecting-overlay {
      position: fixed;
      inset: 0;
      background: var(--bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 200;
      gap: 1rem;
    }
    #connecting-overlay.hidden { display: none !important; }
    .spinner {
      width: 36px;
      height: 36px;
      border: 3px solid var(--border);
      border-top-color: var(--text);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .connect-msg { font-size: .875rem; color: var(--text-muted); }

    /* â”€â”€â”€ RESULTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #results-screen .results-wrap {
      width: 100%;
      max-width: 480px;
    }
    .results-heading {
      font-family: var(--font-serif);
      font-size: 2rem;
      font-weight: 900;
      margin-bottom: .25rem;
    }
    .results-word {
      font-size: .85rem;
      color: var(--text-muted);
      margin-bottom: 1.75rem;
    }
    .results-word strong {
      font-size: 1.1rem;
      color: var(--text);
      letter-spacing: .1em;
      text-transform: uppercase;
    }
    .result-row {
      display: flex;
      align-items: center;
      gap: .75rem;
      padding: .75rem 1rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      margin-bottom: .5rem;
    }
    .result-rank {
      font-size: 1.1rem;
      font-weight: 700;
      width: 24px;
      text-align: center;
      flex-shrink: 0;
    }
    .result-name { flex: 1; font-weight: 600; }
    .result-status {
      font-size: .75rem;
      font-weight: 700;
      padding: .2rem .6rem;
      border-radius: 12px;
    }
    .result-status.solved { background: var(--correct); color: #fff; }
    .result-status.failed { background: var(--absent); color: var(--text-muted); }
    .result-attempts { font-size: .75rem; color: var(--text-muted); }

    /* Mini guess grid in results */
    .mini-grid {
      display: flex;
      flex-direction: column;
      gap: 2px;
      margin-top: .5rem;
    }
    .mini-row { display: flex; gap: 2px; }
    .mini-tile {
      width: 12px;
      height: 12px;
      border-radius: 2px;
      background: var(--border);
    }
    .mini-tile.correct { background: var(--correct); }
    .mini-tile.present { background: var(--present); }
    .mini-tile.absent  { background: var(--absent); }

    /* â”€â”€â”€ MISC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .error-msg {
      font-size: .8rem;
      color: var(--danger);
      margin-top: .5rem;
      min-height: 1.2em;
    }
    .info-chip {
      display: inline-flex;
      align-items: center;
      gap: .35rem;
      font-size: .75rem;
      color: var(--text-muted);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: .2rem .65rem;
    }
    .copied-flash { color: var(--correct) !important; border-color: var(--correct) !important; }

    /* â”€â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 700px) {
      #game-screen { flex-direction: column; align-items: center; padding-top: 1rem; }
      .game-sidebar { width: 100%; max-width: 400px; display: flex; flex-wrap: wrap; gap: .3rem; }
      .game-sidebar .sidebar-title { width: 100%; }
      .mp-player-item { flex: 0 1 auto; }
      .key { min-width: 28px; height: 48px; font-size: .72rem; }
      .key.wide { min-width: 46px; }
    }
    @media (max-width: 400px) {
      .key { min-width: 24px; height: 44px; }
      .key.wide { min-width: 40px; }
    }
  </style>
</head>
<body>

<!-- â”€â”€â”€ CONNECTING OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="connecting-overlay">
  <div class="spinner"></div>
  <div class="connect-msg">Connecting to serverâ€¦</div>
  <div class="connect-msg" style="font-size:.75rem;margin-top:-.5rem;color:var(--text-muted);max-width:260px;text-align:center">
    Free tier may need 30â€“60 s to wake up
  </div>
</div>

<!-- â”€â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<header>
  <div class="logo">WORD<span>uel</span></div>
  <div class="header-actions">
    <button class="icon-btn" id="theme-btn" title="Toggle theme">â˜€ Light</button>
  </div>
</header>

<!-- â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="toast-container"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- SCREEN: HOME -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section class="screen" id="home-screen">
  <h1 class="home-title">WORDUEL</h1>
  <p class="tagline">multiplayer word guessing â€” any length, any room</p>

  <!-- Name card -->
  <div class="card">
    <h2>Your Name</h2>
    <div class="name-row">
      <label for="player-name">Name</label>
      <input class="input-field" id="player-name" type="text" maxlength="20" placeholder="Anonymous" />
    </div>
  </div>

  <!-- Singleplayer card -->
  <div class="card" style="margin-top:1rem">
    <h2>Singleplayer</h2>
    <div class="length-label">Word length</div>
    <div class="length-picker" id="sp-length-picker"></div>
    <button class="btn btn-primary" id="sp-start-btn">Play Solo</button>
  </div>

  <!-- Multiplayer card -->
  <div class="card" style="margin-top:1rem">
    <h2>Multiplayer</h2>
    <div class="tabs" id="mp-tabs">
      <button class="tab active" data-tab="public">Public Room</button>
      <button class="tab" data-tab="private-create">Create Private</button>
      <button class="tab" data-tab="private-join">Join Private</button>
    </div>

    <!-- Public -->
    <div id="tab-public">
      <div class="length-label">Word length</div>
      <div class="length-picker" id="pub-length-picker"></div>
      <button class="btn btn-primary" id="pub-join-btn">Find Public Room</button>
    </div>

    <!-- Private Create -->
    <div id="tab-private-create" class="hidden">
      <div class="length-label">Word length</div>
      <div class="length-picker" id="priv-c-length-picker"></div>
      <div class="maxp-row">
        <label for="maxp-range">Max players</label>
        <input type="range" id="maxp-range" min="2" max="20" value="8" />
        <span class="maxp-val" id="maxp-display">8</span>
      </div>
      <button class="btn btn-primary" id="priv-create-btn">Create Private Room</button>
    </div>

    <!-- Private Join -->
    <div id="tab-private-join" class="hidden">
      <div class="code-row">
        <input class="code-input" id="join-code-input" type="text" maxlength="6" placeholder="Enter room codeâ€¦" />
        <button class="btn btn-primary" style="width:auto;padding:.5rem 1rem" id="priv-join-btn">Join</button>
      </div>
    </div>

    <div class="error-msg" id="home-error"></div>
  </div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- SCREEN: LOBBY -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section class="screen hidden" id="lobby-screen">
  <div class="lobby-wrap">
    <div class="lobby-header">
      <div class="room-code-badge" id="lobby-code-badge" title="Click to copy">
        <small>Room Code</small>
        <span id="lobby-code-text">â€”â€”</span>
      </div>
      <div class="lobby-meta" id="lobby-meta"></div>
    </div>

    <div class="countdown-ring hidden" id="lobby-countdown">
      <span id="countdown-num">30</span>
      <small>auto-start in</small>
    </div>

    <div class="player-list" id="lobby-player-list">
      <div class="player-list-header">Players</div>
    </div>

    <div class="error-msg" id="lobby-error"></div>

    <button class="btn btn-primary hidden" id="lobby-start-btn">Start Game</button>
    <button class="btn btn-ghost" id="lobby-leave-btn" style="margin-top:.6rem">Leave Room</button>
  </div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- SCREEN: GAME -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section class="screen hidden" id="game-screen">
  <!-- Sidebar (multiplayer) -->
  <div class="game-sidebar hidden" id="game-sidebar">
    <div class="sidebar-title">Players</div>
    <div id="sidebar-player-list"></div>
  </div>

  <!-- Board + keyboard -->
  <div class="game-center">
    <div id="board"></div>
    <div id="keyboard"></div>
  </div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- SCREEN: RESULTS -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section class="screen hidden" id="results-screen">
  <div class="results-wrap">
    <h2 class="results-heading" id="results-heading">Game Over</h2>
    <p class="results-word" id="results-word"></p>
    <div id="results-list"></div>
    <button class="btn btn-primary" id="results-play-again" style="margin-top:1.5rem">Play Again</button>
    <button class="btn btn-ghost" id="results-home" style="margin-top:.6rem">Back to Home</button>
  </div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- JAVASCRIPT -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CONFIG â€” Change SERVER_URL to your Render URL after deployment
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SERVER_URL = 'https://wordle-rj7i.onrender.com';

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const state = {
  mode: 'solo',      // 'solo' | 'multi'
  wordLength: 5,
  word: '',          // solo only
  maxAttempts: 6,
  currentRow: 0,
  currentCol: 0,
  currentGuess: [],
  board: [],         // 2d array of tile elements
  keyEls: {},        // letter â†’ key element
  finished: false,
  myId: '',
  roomCode: '',
  isHost: false,
  players: [],
  spLength: 5,
  pubLength: 5,
  privCLength: 5,
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SOCKET
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const socket = io(SERVER_URL, { autoConnect: true, reconnectionDelay: 1500 });

const overlay = document.getElementById('connecting-overlay');
socket.on('connect', () => { overlay.classList.add('hidden'); requestWordLengths(); });
socket.on('connect_error', () => { overlay.querySelector('.connect-msg').textContent = 'Reconnectingâ€¦'; });
socket.on('disconnect', () => { overlay.classList.remove('hidden'); });

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// THEME
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const themeBtn = document.getElementById('theme-btn');
let isDark = true;
themeBtn.addEventListener('click', () => {
  isDark = !isDark;
  document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
  themeBtn.textContent = isDark ? 'â˜€ Light' : 'â˜½ Dark';
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// WORD LENGTHS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let availableLengths = [3,4,5,6,7,8];

function requestWordLengths() {
  socket.emit('getAvailableLengths');
}

socket.on('availableLengths', (lengths) => {
  availableLengths = lengths.length ? lengths : availableLengths;
  buildAllPickers();
});

function buildAllPickers() {
  buildPicker('sp-length-picker',    'spLength',    state.spLength);
  buildPicker('pub-length-picker',   'pubLength',   state.pubLength);
  buildPicker('priv-c-length-picker','privCLength',  state.privCLength);
}

function buildPicker(containerId, stateKey, selected) {
  const container = document.getElementById(containerId);
  container.innerHTML = '';
  for (const len of availableLengths) {
    const btn = document.createElement('button');
    btn.className = 'len-btn' + (len === selected ? ' active' : '');
    btn.textContent = len;
    btn.addEventListener('click', () => {
      state[stateKey] = len;
      container.querySelectorAll('.len-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    });
    container.appendChild(btn);
  }
  if (!availableLengths.includes(selected) && availableLengths.length) {
    state[stateKey] = availableLengths.find(l => l === 5) || availableLengths[0];
    container.querySelector('.len-btn')?.classList.add('active');
  }
}

buildAllPickers(); // initial render with defaults

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TABS (multiplayer)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('mp-tabs').addEventListener('click', e => {
  const tab = e.target.closest('.tab');
  if (!tab) return;
  document.querySelectorAll('#mp-tabs .tab').forEach(t => t.classList.remove('active'));
  tab.classList.add('active');
  const key = tab.dataset.tab;
  ['tab-public','tab-private-create','tab-private-join'].forEach(id => {
    document.getElementById(id).classList.toggle('hidden', id !== `tab-${key}`);
  });
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// MAX PLAYERS SLIDER
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const maxpRange = document.getElementById('maxp-range');
const maxpDisplay = document.getElementById('maxp-display');
maxpRange.addEventListener('input', () => { maxpDisplay.textContent = maxpRange.value; });

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SCREEN SWITCHER
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}
showScreen('home-screen');

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// HOME ACTIONS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getPlayerName() {
  return document.getElementById('player-name').value.trim() || 'Anonymous';
}

// Solo
document.getElementById('sp-start-btn').addEventListener('click', () => {
  const len = state.spLength;
  state.mode = 'solo';
  state.wordLength = len;
  socket.emit('getWord', { wordLength: len });
});

socket.on('wordAssigned', ({ word }) => {
  state.word = word;
  state.wordLength = word.length;
  startGame();
});

// Public room
document.getElementById('pub-join-btn').addEventListener('click', () => {
  setHomeError('');
  socket.emit('joinPublicRoom', { wordLength: state.pubLength, playerName: getPlayerName() });
});

// Private create
document.getElementById('priv-create-btn').addEventListener('click', () => {
  setHomeError('');
  socket.emit('createPrivateRoom', {
    wordLength: state.privCLength,
    maxPlayers: parseInt(maxpRange.value, 10),
    playerName: getPlayerName()
  });
});

// Private join
document.getElementById('priv-join-btn').addEventListener('click', joinPrivateRoom);
document.getElementById('join-code-input').addEventListener('keydown', e => {
  if (e.key === 'Enter') joinPrivateRoom();
});
function joinPrivateRoom() {
  setHomeError('');
  const code = document.getElementById('join-code-input').value.trim().toUpperCase();
  if (code.length < 4) { setHomeError('Enter a valid room code.'); return; }
  socket.emit('joinPrivateRoom', { roomCode: code, playerName: getPlayerName() });
}

function setHomeError(msg) {
  document.getElementById('home-error').textContent = msg;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// LOBBY
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
socket.on('roomJoined', ({ roomCode, room, isHost, myId }) => {
  state.mode = 'multi';
  state.roomCode = roomCode;
  state.isHost = isHost;
  state.myId = myId;
  state.wordLength = room.wordLength;

  // Render lobby
  document.getElementById('lobby-code-text').textContent = roomCode;
  document.getElementById('lobby-meta').innerHTML =
    `${room.wordLength}-letter words<br>` +
    (room.type === 'public' ? 'Public room' : `Private Â· max ${room.maxPlayers || 'âˆ'} players`);

  document.getElementById('lobby-start-btn').classList.toggle('hidden', !isHost || room.type === 'public');
  if (room.type === 'public') document.getElementById('lobby-countdown').classList.remove('hidden');

  showScreen('lobby-screen');
  document.getElementById('lobby-error').textContent = '';
});

socket.on('playerList', (players) => {
  state.players = players;
  renderLobbyPlayers(players);
  renderSidebarPlayers(players);
});

function renderLobbyPlayers(players) {
  const list = document.getElementById('lobby-player-list');
  list.innerHTML = '<div class="player-list-header">Players</div>';
  players.forEach((p, i) => {
    const el = document.createElement('div');
    el.className = 'player-item';
    const initials = p.name.slice(0,2).toUpperCase();
    const tags = [];
    if (i === 0) tags.push('<span class="player-tag host">HOST</span>');
    if (p.id === state.myId) tags.push('<span class="player-tag you">YOU</span>');
    el.innerHTML = `
      <div class="player-avatar">${initials}</div>
      <div class="player-name">${escHtml(p.name)}</div>
      ${tags.join('')}`;
    list.appendChild(el);
  });
}

socket.on('countdown', (n) => {
  document.getElementById('countdown-num').textContent = n;
});

socket.on('newHost', (hostId) => {
  state.isHost = hostId === state.myId;
  document.getElementById('lobby-start-btn').classList.toggle('hidden', !state.isHost);
});

document.getElementById('lobby-start-btn').addEventListener('click', () => {
  socket.emit('startGame');
});
document.getElementById('lobby-leave-btn').addEventListener('click', () => {
  socket.disconnect();
  socket.connect();
  showScreen('home-screen');
});
document.getElementById('lobby-code-badge').addEventListener('click', () => {
  navigator.clipboard.writeText(state.roomCode).catch(()=>{});
  toast('Code copied!');
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// GAME START
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
socket.on('gameStart', ({ wordLength }) => {
  state.wordLength = wordLength;
  state.word = ''; // server holds word in multiplayer
  startGame();
});

function startGame() {
  state.currentRow = 0;
  state.currentCol = 0;
  state.currentGuess = [];
  state.finished = false;

  const wl = state.wordLength;
  const rows = 6;

  // Build board
  const board = document.getElementById('board');
  board.innerHTML = '';
  const tileSize = wl <= 5 ? 60 : wl <= 7 ? 50 : wl <= 9 ? 42 : 36;
  board.style.gridTemplateColumns = `repeat(${wl}, ${tileSize}px)`;
  board.style.gridTemplateRows = `repeat(${rows}, ${tileSize}px)`;

  state.board = [];
  for (let r = 0; r < rows; r++) {
    state.board[r] = [];
    for (let c = 0; c < wl; c++) {
      const tile = document.createElement('div');
      tile.className = 'tile';
      tile.style.width = tile.style.height = tileSize + 'px';
      tile.style.fontSize = (tileSize * .52) + 'px';
      board.appendChild(tile);
      state.board[r][c] = tile;
    }
  }

  // Build keyboard
  buildKeyboard();

  // Show/hide sidebar
  const sidebar = document.getElementById('game-sidebar');
  if (state.mode === 'multi') {
    sidebar.classList.remove('hidden');
    renderSidebarPlayers(state.players);
  } else {
    sidebar.classList.add('hidden');
  }

  showScreen('game-screen');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// KEYBOARD
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const KB_ROWS = [
  ['Q','W','E','R','T','Y','U','I','O','P'],
  ['A','S','D','F','G','H','J','K','L'],
  ['ENTER','Z','X','C','V','B','N','M','âŒ«']
];

function buildKeyboard() {
  const kb = document.getElementById('keyboard');
  kb.innerHTML = '';
  state.keyEls = {};
  KB_ROWS.forEach(row => {
    const rowEl = document.createElement('div');
    rowEl.className = 'kb-row';
    row.forEach(key => {
      const btn = document.createElement('button');
      btn.className = 'key' + (key.length > 1 ? ' wide' : '');
      btn.textContent = key;
      btn.dataset.key = key;
      btn.addEventListener('click', () => handleKey(key));
      if (key.length === 1) state.keyEls[key] = btn;
      rowEl.appendChild(btn);
    });
    kb.appendChild(rowEl);
  });
}

// Physical keyboard
document.addEventListener('keydown', e => {
  if (document.getElementById('game-screen').classList.contains('hidden')) return;
  if (e.ctrlKey || e.altKey || e.metaKey) return;
  if (e.key === 'Enter') handleKey('ENTER');
  else if (e.key === 'Backspace') handleKey('âŒ«');
  else if (/^[a-zA-Z]$/.test(e.key)) handleKey(e.key.toUpperCase());
});

function handleKey(key) {
  if (state.finished) return;
  const wl = state.wordLength;

  if (key === 'âŒ«') {
    if (state.currentCol > 0) {
      state.currentCol--;
      state.currentGuess.pop();
      state.board[state.currentRow][state.currentCol].textContent = '';
      state.board[state.currentRow][state.currentCol].classList.remove('filled');
    }
  } else if (key === 'ENTER') {
    if (state.currentCol < wl) { toast('Not enough letters'); shakeRow(state.currentRow); return; }
    submitGuess();
  } else {
    if (state.currentCol >= wl) return;
    const tile = state.board[state.currentRow][state.currentCol];
    tile.textContent = key;
    tile.classList.add('filled');
    state.currentGuess.push(key.toLowerCase());
    state.currentCol++;
  }
}

function submitGuess() {
  const guess = state.currentGuess.join('');

  if (state.mode === 'solo') {
    // Validate server-side, then do client-side check
    socket.emit('validateGuess', { guess, wordLength: state.wordLength });
    socket._pendingGuess = guess;
  } else {
    socket.emit('guess', { guess });
  }
}

// Solo validation response
socket.on('wordValid', () => {
  const guess = socket._pendingGuess;
  if (!guess) return;
  const result = checkGuessLocal(guess, state.word);
  revealRow(state.currentRow, guess, result);
  updateKeys(guess, result);
  const solved = result.every(r => r === 'correct');
  state.currentRow++;
  state.currentCol = 0;
  state.currentGuess = [];
  if (solved) {
    state.finished = true;
    setTimeout(() => showResultsSolo(true), 1800);
  } else if (state.currentRow >= 6) {
    state.finished = true;
    setTimeout(() => showResultsSolo(false), 1800);
  }
});

socket.on('invalidWord', () => {
  toast('Not in word list');
  shakeRow(state.currentRow);
});

// Multiplayer guess result
socket.on('guessResult', ({ guess, result, solved, attempts, finished, word }) => {
  revealRow(state.currentRow, guess, result);
  updateKeys(guess, result);
  state.currentRow++;
  state.currentCol = 0;
  state.currentGuess = [];
  if (finished) {
    state.finished = true;
    if (solved) {
      toast('ğŸ‰ Solved in ' + attempts + (attempts === 1 ? ' guess!' : ' guesses!'));
    } else {
      toast('The word was: ' + (word || '?').toUpperCase());
    }
  }
});

socket.on('playerUpdate', (player) => {
  // Update sidebar
  state.players = state.players.map(p => p.id === player.id ? { ...p, ...player } : p);
  renderSidebarPlayers(state.players);
});

socket.on('gameEnd', ({ results, word }) => {
  setTimeout(() => showResultsMulti(results, word), 1000);
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// LOCAL CHECK (solo)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function checkGuessLocal(guess, word) {
  const result = new Array(word.length).fill('absent');
  const wordChars = word.split('');
  const used = new Array(word.length).fill(false);
  for (let i = 0; i < guess.length; i++) {
    if (guess[i] === wordChars[i]) { result[i] = 'correct'; used[i] = true; }
  }
  for (let i = 0; i < guess.length; i++) {
    if (result[i] === 'correct') continue;
    for (let j = 0; j < word.length; j++) {
      if (!used[j] && guess[i] === wordChars[j]) { result[i] = 'present'; used[j] = true; break; }
    }
  }
  return result;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// REVEAL ROW
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function revealRow(row, guess, result) {
  const delay = 300; // ms per tile
  result.forEach((state, col) => {
    setTimeout(() => {
      const tile = window.state.board[row][col];
      tile.classList.add('revealed');
      tile.dataset.state = state;
    }, col * delay);
  });
}

function shakeRow(row) {
  const tiles = state.board[row];
  tiles.forEach(t => {
    t.classList.remove('row-shake');
    void t.offsetWidth; // reflow
    t.classList.add('row-shake');
  });
}

function updateKeys(guess, result) {
  const priority = { correct: 3, present: 2, absent: 1 };
  for (let i = 0; i < guess.length; i++) {
    const key = state.keyEls[guess[i].toUpperCase()];
    if (!key) continue;
    const current = key.dataset.state;
    if (!current || priority[result[i]] > (priority[current] || 0)) {
      key.dataset.state = result[i];
    }
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SIDEBAR
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderSidebarPlayers(players) {
  const list = document.getElementById('sidebar-player-list');
  list.innerHTML = '';
  players.forEach(p => {
    const el = document.createElement('div');
    el.className = 'mp-player-item' + (p.id === state.myId ? ' is-you' : '');
    const pipClass = p.solved ? 'solved' : p.finished ? 'failed' : p.attempts > 0 ? 'active' : '';
    el.innerHTML = `
      <div class="mp-pip ${pipClass}"></div>
      <div class="mp-player-name" title="${escHtml(p.name)}">${escHtml(p.name)}</div>
      <div class="mp-player-score">${p.attempts}/6</div>`;
    list.appendChild(el);
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// RESULTS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showResultsSolo(solved) {
  document.getElementById('results-heading').textContent = solved ? 'Solved!' : 'Better luck next time';
  document.getElementById('results-word').innerHTML = `The word was <strong>${state.word.toUpperCase()}</strong>`;
  document.getElementById('results-list').innerHTML = '';
  showScreen('results-screen');
}

function showResultsMulti(results, word) {
  const winner = results.find(r => r.solved);
  document.getElementById('results-heading').textContent = winner ? `${escHtml(winner.name)} wins!` : 'No one solved it';
  document.getElementById('results-word').innerHTML = `The word was <strong>${(word||'').toUpperCase()}</strong>`;

  const list = document.getElementById('results-list');
  list.innerHTML = '';
  results.forEach((r, i) => {
    const rankEmoji = i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : (i + 1);
    const el = document.createElement('div');
    el.className = 'result-row';
    const miniHtml = r.guesses.map(g =>
      `<div class="mini-row">${g.result.map(s => `<div class="mini-tile ${s}"></div>`).join('')}</div>`
    ).join('');
    el.innerHTML = `
      <div class="result-rank">${rankEmoji}</div>
      <div>
        <div class="result-name">${escHtml(r.name)}</div>
        <div class="mini-grid">${miniHtml}</div>
      </div>
      <div>
        <div class="result-status ${r.solved ? 'solved' : 'failed'}">${r.solved ? 'âœ“ ' + r.attempts + '/6' : 'âœ—'}</div>
      </div>`;
    list.appendChild(el);
  });
  showScreen('results-screen');
}

document.getElementById('results-play-again').addEventListener('click', () => {
  if (state.mode === 'solo') {
    socket.emit('getWord', { wordLength: state.wordLength });
  } else {
    // Re-join same room type â€” for simplicity, go back to home
    showScreen('home-screen');
    toast('Start a new room from the menu');
  }
});
document.getElementById('results-home').addEventListener('click', () => {
  showScreen('home-screen');
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ERROR HANDLING
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
socket.on('roomError', (msg) => {
  setHomeError(msg);
  document.getElementById('lobby-error').textContent = msg;
  toast(msg);
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TOAST
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toast(msg) {
  const container = document.getElementById('toast-container');
  const el = document.createElement('div');
  el.className = 'toast';
  el.textContent = msg;
  container.appendChild(el);
  setTimeout(() => el.remove(), 2100);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// HELPERS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function escHtml(s) {
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
</script>
</body>
</html>
